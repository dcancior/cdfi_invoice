<?xml version="1.0"?>
<odoo>
    <data>
       <record id="view_partner_form_cfdi_before_notebook" model="ir.ui.view">
            <field name="name">res.partner.form.inherit.cfdi.before.notebook</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="priority" eval="30"/>
            <field name="arch" type="xml">

                <!-- Inserta ANTES del notebook del formulario principal -->
                <xpath expr="//sheet//notebook" position="before">
                <separator string="Datos CFDI"/>

                <group>
                    <!-- Columna izquierda: Preferencias de factura -->
                    <group string="Preferencias de factura" col="2">
                    <label for="uso_cfdi_id" class="o_form_label" style="font-weight:400;">Uso CFDI (cliente)</label>
                    <field name="uso_cfdi_id" nolabel="1"
                            options="{'no_quick_create': True, 'no_create_edit': True}"/>

                    <label for="regimen_fiscal_id" class="o_form_label" style="font-weight:400;">R茅gimen Fiscal</label>
                    <field name="regimen_fiscal_id" nolabel="1"
                            options="{'no_quick_create': True, 'no_create_edit': True}"/>
                    </group>

                    <!-- Columna derecha: Detalles extranjero -->
                    <group string="Detalles extranjero" col="2">
                    <label for="residencia_fiscal" class="o_form_label" style="font-weight:400;">Residencia Fiscal</label>
                    <field name="residencia_fiscal" nolabel="1"/>

                    <label for="registro_tributario" class="o_form_label" style="font-weight:400;">Registro Tributario</label>
                    <field name="registro_tributario" nolabel="1"/>
                    </group>
                </group>
                </xpath>

            </field>
            </record>






        <record id="view_partner_address_form_inherit_cfdi" model="ir.ui.view">
            <field name="name">res.partner.form.address.inherit.cfdi</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
                <field name="arch" type="xml">
                    <xpath expr="//page[@name='contact_addresses']" position="replace">
                        <page string="Contactos y Facturaci贸n" name="contact_addresses" autofocus="autofocus">
                            <field name="child_ids" mode="kanban" context="{'default_parent_id': active_id, 'default_street': street, 'default_street2': street2, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_lang': lang, 'default_user_id': user_id, 'default_type': 'contact'}">
                                <kanban>
                                    <field name="id"/>
                                    <field name="color"/>
                                    <field name="name"/>
                                    <field name="uso_cfdi_id"/>
                                    <field name="regimen_fiscal_id"/>
                                    <field name="title"/>
                                    <field name="type"/>
                                    <field name="email"/>
                                    <field name="parent_id"/>
                                    <field name="is_company"/>
                                    <field name="function"/>
                                    <field name="phone"/>
                                    <field name="street"/>
                                    <field name="street2"/>
                                    <field name="zip"/>
                                    <field name="city"/>
                                    <field name="country_id"/>
                                    <field name="mobile"/>
                                    <field name="state_id"/>
                                    <field name="image_128"/>
                                    <field name="avatar_128"/>
                                    <field name="lang"/>
                                    <!-- fields in form x2many view to diminish requests -->
                                    <field name="comment"/>
                                    <field name="display_name"/>
                                    <!--  Cargar el RFC -->
                                    <field name="vat"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <t t-set="color" t-value="kanban_color(record.color.raw_value)"/>
                                            <div t-att-class="color + (record.title ? (record.title.raw_value == 1 ? ' oe_kanban_color_alert' : '') : '') + ' oe_kanban_global_click'">
                                                <div class="o_kanban_image">
                                                    <img alt="Contact image" t-att-src="kanban_image('res.partner', 'avatar_128', record.id.raw_value)"/>
                                                </div>
                                                <div class="oe_kanban_details">
                                                    <field name="name"/>

                                                    <!-- RFC con doble guardia por si no est谩 cargado -->
                                                    <div t-if="record.vat and record.vat.raw_value" class="text-muted">
                                                        RFC: <t t-esc="record.vat.value"/>
                                                    </div>

                                                    <div t-if="record.function and record.function.raw_value"><field name="function"/></div>
                                                    <div t-if="record.email and record.email.raw_value"><field name="email" widget="email"/></div>

                                                    <div t-if="record.type and record.type.raw_value != 'contact'">
                                                        <div>
                                                            <field name="zip"/><t t-if="record.city"> </t>
                                                            <field name="city"/>
                                                        </div>
                                                        <field t-if="record.state_id and record.state_id.raw_value" name="state_id"/><t t-if="record.country_id"> </t>
                                                        <field name="country_id"/>
                                                    </div>

                                                    <div t-if="record.phone and record.phone.raw_value">Phone: <t t-esc="record.phone.value"/></div>
                                                    <div t-if="record.mobile and record.mobile.raw_value">Mobile: <t t-esc="record.mobile.value"/></div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                <form string="Contact / Address">
                                    <sheet>
                                        <field name="type" required="1" widget="radio" options="{'horizontal': true}"/>
                                        <field name="parent_id" invisible="1"/>
                                        <div class="text-muted oe_edit_only">
                                            <p class="mb-0" attrs="{'invisible': [('type', '!=', 'contact')]}">
                                                <span>Utilice esto para organizar los datos de contacto de los empleados de una empresa determinada (por ejemplo, Director, Jefe de Compras, ...).</span>
                                            </p>
                                            <p class="mb-0" attrs="{'invisible': [('type', '!=', 'invoice')]}">
                                                <span>Diferentes configuraciones fiscales para facturar.</span>
                                            </p>
                                            <p class="mb-0" attrs="{'invisible': [('type', '!=', 'delivery')]}">
                                                <span>Direcci贸n preferida para todos los env铆os. Seleccionada por defecto al entregar un pedido de esta empresa.</span>
                                            </p>
                                            <p class="mb-0" attrs="{'invisible': [('type', '!=', 'private')]}">
                                                <span>Las direcciones privadas s贸lo son visibles para usuarios autorizados y contienen datos sensibles (direcciones de domicilio de empleados, ...).</span>
                                            </p>
                                            <p class="mb-0" attrs="{'invisible': [('type', '!=', 'other')]}">
                                                <span>Otra direcci贸n para la empresa (por ejemplo, filial, ...)</span>
                                            </p>
                                        </div>
                                        <separator string="Datos principales" colspan="4"/>
                                        <group attrs="{'invisible': [('type', '!=', 'contact')]}">
                                            <group string="Contacto">
                                                <field name="name" string="Nombre de Contacto" attrs="{'required': [('type', '=', 'contact')]}"/>
                                                <field name="title"/>
                                                <field name="function"/>
                                            </group>
                                            <group string="Informaci贸n de contacto">
                                                <field name="email" string="Email" widget="email"/>
                                                <field name="phone" string="Tel茅fono" widget="phone"/>
                                                <field name="mobile" string="Celular" widget="phone"/>
                                            </group>
                                        </group>

                                        <group attrs="{'invisible': [('type', '!=', 'invoice')]}">
                                            <group string="Datos fiscales">
                                                <field name="name" string="Nombre o Raz贸n Social" attrs="{'required': [('type', '=', 'invoice')]}"/>
                                                <field name="street"/>
                                                <field name="street2"/>
                                                <field name="city"/>
                                                <field name="state_id"/>
                                                <field name="zip"/>
                                                <field name="country_id"/>
                                            </group>
                                            <group string="Preferencias de factura">
                                                <field name="vat" string="RFC"/>
                                                <field name="uso_cfdi_id"/>
                                                <field name="regimen_fiscal_id"/>
                                            </group>
                                            <group string="Detalles extranjero">
                                                <field name="residencia_fiscal"/>
                                                <field name="registro_tributario"/>
                                            </group>
                                            <group string="Informaci贸n de contacto">
                                                <field name="email" string="Email" widget="email"/>
                                                <field name="phone" string="Tel茅fono" widget="phone"/>
                                                <field name="mobile" string="Celular" widget="phone"/>
                                            </group>
                                        </group>

                                        <group attrs="{'invisible': [('type', '!=', 'delivery')]}">
                                            <group string="Direcci贸n de entrega">
                                                <field name="name" string="Nombre de Contacto" attrs="{'required': [('type', '=', 'delivery')]}"/>
                                                <field name="street"/>
                                                <field name="street2"/>
                                                <field name="city"/>
                                                <field name="state_id"/>
                                                <field name="zip"/>
                                                <field name="country_id"/>
                                            </group>
                                            <group string="Informaci贸n de contacto">
                                                <field name="email" string="Email" widget="email"/>
                                                <field name="phone" string="Tel茅fono" widget="phone"/>
                                                <field name="mobile" string="Celular" widget="phone"/>
                                            </group>
                                        </group>

                                        <group attrs="{'invisible': [('type', '!=', 'private')]}">
                                            <group string="Direcci贸n privada">
                                                <field name="name" string="Nombre de Contacto" attrs="{'required': [('type', '=', 'private')]}"/>
                                                <field name="street"/>
                                                <field name="street2"/>
                                                <field name="city"/>
                                                <field name="state_id"/>
                                                <field name="zip"/>
                                                <field name="country_id"/>
                                            </group>
                                            <group string="Informaci贸n de contacto">
                                                <field name="email" string="Email" widget="email"/>
                                                <field name="phone" string="Tel茅fono" widget="phone"/>
                                                <field name="mobile" string="Celular" widget="phone"/>
                                            </group>
                                        </group>

                                        <group attrs="{'invisible': [('type', '!=', 'other')]}">
                                            <group string="Otra direcci贸n">
                                                <field name="name" string="Nombre de Contacto" attrs="{'required': [('type', '=', 'other')]}"/>
                                                <field name="street"/>
                                                <field name="street2"/>
                                                <field name="city"/>
                                                <field name="state_id"/>
                                                <field name="zip"/>
                                                <field name="country_id"/>
                                            </group>
                                            <group string="Informaci贸n de contacto">
                                                <field name="email" string="Email" widget="email"/>
                                                <field name="phone" string="Tel茅fono" widget="phone"/>
                                                <field name="mobile" string="Celular" widget="phone"/>
                                            </group>
                                        </group>
                                        <separator string="Notas internas" colspan="4"/>
                                        <group>
                                            <field name="comment" placeholder="Notas internas..." nolabel="1" colspan="2"/>
                                        </group>
                                        <field name="lang" invisible="True"/>
                                        <field name="user_id" invisible="True"/>
                                    </sheet>
                                </form>
                            </field>
                        </page>

                    
                </xpath>
            </field>
        </record>

        <!-- Vista para ocultar la pagina de Facturacion en la vista de partner-->
        <record id="view_partner_form_hide_accounting" model="ir.ui.view">
            <field name="name">res.partner.form.hide.accounting</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='accounting']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
            </field>
        </record>
    </data>
</odoo>